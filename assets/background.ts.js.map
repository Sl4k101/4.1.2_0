{
  "version": 3,
  "file": "background.ts.js",
  "sources": [
    "../../src/plugins/captaina/functions/message.js",
    "../../src/plugins/captaina/workers/scraping.js",
    "../../src/background.ts"
  ],
  "sourcesContent": [
    "/*\n *    Copyright 2022 Umut TAN | umuttan@outlook.com | https://bitbucket.org/umut_tan/captainextension/src/master/\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n *    this page updated on 27.12.2022\n */\n\nimport Browser from \"webextension-polyfill\";\nimport {Helpers} from \"../../../classes/Helpers\";\n\nBrowser.runtime.onMessage.addListener(((callback, sender, sendResponse) => {\n    let data = [];\n    let return_data = null;\n    if (typeof callback.data != 'undefined') data = callback.data;\n\n    return_data = Helpers.messageExecute(null, callback['fn'], data);\n\n    return Helpers.messageSendResponse(return_data, data, sender, sendResponse);\n}));",
    "/*\n *    Copyright 2022 Umut TAN | umuttan@outlook.com | https://bitbucket.org/umut_tan/captainextension/src/master/\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n *    this page updated on 26.12.2022\n */\n\nimport {VariableDefine} from \"../variable_define.ts\";\nimport {Helpers} from \"../../../classes/Helpers\";\nimport Browser from \"webextension-polyfill\";\n\nif (typeof ScrappingInit == 'undefined') {\n    var ScrapStart = 0;\n    var waitTime = 4000;\n    var restartTime = 40000;\n    var appStatus = 1;\n    var ScrapCount = 1;\n    var LastScrapCount = 0;\n    var ScrapTime = Date.now();\n    var interValId = null;\n    var collections = [];\n\n    this.ScrapCollection = () => {\n        let _time = ((Math.random() + 1) * waitTime).toFixed(0);\n        /*setTimeout(ScrapCollection, _time);*/\n        Browser.storage.sync.get('start_scrap').then(function (result) {\n            if (typeof result['start_scrap'] == 'undefined') result['start_scrap'] = 0;\n            ScrapStart = result['start_scrap'];\n            if (ScrapStart === 1) {\n                if (VariableDefine.debugMode) console.log('Running', _time)\n                return;\n            }\n            if (VariableDefine.debugMode) console.log('Starting', _time, 'scrapCout: ' + ScrapCount, (new Date().toISOString().replaceAll(/-/g, '_')));\n            ScrapStart = 1;\n            Browser.storage.local.set({start_scrap: 1}).then(() => {\n                if (Object.keys(collections).length > 0) {\n                    return _fn_get_builder({'collections': collections});\n                }\n                Helpers.fetchWithTimeout(VariableDefine.api_url + '/extensions/scraping/get?' + new Date().toISOString().replaceAll(/-/g, '_'), {\n                    'method': 'POST',\n                    'headers': {'Content-type': 'application/json'},\n                    'body': JSON.stringify({'merchants': Object.keys(VariableDefine.merchants ?? {})})\n                }, 30000).then(response => (response.text() ?? response)).then(response => {\n                    let data = JSON.parse(response);\n                    if (data.status == 'success') {\n                        data = data.data;\n                        return _fn_get_builder(data);\n                    } else {\n                        setTimeout(() => {\n                            ScarpingEnd()\n                        }, restartTime * 2);\n                    }\n                }).catch((response) => {\n                    if (VariableDefine.debugMode) console.log(response);\n                });\n            });\n        });\n    }\n\n    function _fn_get_builder(data) {\n        if (typeof data.wait_time != 'undefined') waitTime = data.wait_time;\n        if (typeof data.restart_time != 'undefined') restartTime = data.restart_time;\n        if (typeof data.app_status != 'undefined') appStatus = data.app_status;\n        if (typeof data.collections != 'undefined') {\n            collections = data.collections;\n            let _start = 0;\n            if (VariableDefine.debugMode) console.log(collections);\n            collections.forEach((item, key) => {\n                if (_start == 0 && typeof item != 'undefined') {\n                    _start = 1;\n                    item = _fn_item_builder(item, data);\n                    ScrapCall(item);\n                    collections.splice(key, 1);\n                    data.collections = collections;\n                    return data;\n                }\n            });\n            return data;\n        } else {\n            let item = _fn_item_builder(data, data);\n            ScrapCall(item);\n        }\n\n        function _fn_item_builder(item, data) {\n            if (typeof item.type == 'undefined' && typeof data.collection == 'undefined') {\n                //this.ScarpingEnd()\n                return;\n            }\n            if (typeof item.market_place_id == 'undefined' && typeof item.marketplace_id != 'undefined') item.market_place_id = item.marketplace_id;\n            if (typeof data.collection != 'undefined') {\n                if (typeof item.market_place_id == 'undefined' && typeof data.collection.market_place_id != 'undefined') item.market_place_id = data.collection.market_place_id;\n            }\n            if (typeof item.url == 'undefined') {\n                item.origin = VariableDefine.marketplace_idBydomain[item.market_place_id];\n                item.url = item.origin + item.uri;\n            } else if (!item.url) {\n                item.origin = VariableDefine.marketplace_idBydomain[item.market_place_id];\n                item.url = item.origin + item.uri;\n            }\n            if (typeof item.market_place_id != 'undefined') {\n                item.base_url = VariableDefine.marketplace_idBydomain[item.market_place_id];\n            }\n            if (typeof data.app_status == 'undefined') data.app_status = appStatus;\n            if (data.app_status != 1) {\n                setTimeout(() => {\n                    this.ScarpingEnd()\n                }, restartTime * 2);\n                return;\n            }\n            return item;\n        }\n\n        return item;\n    }\n\n    this.ScrapCall = (data, api_url = null) => {\n        if (!api_url) api_url = VariableDefine.api_url;\n        ScrapTime = Date.now();\n        let headers = new Headers();\n        headers.append('Access-Control-Allow-Origin', data.origin)\n        return fetch(data.url, {mode: 'same-origin', headers, redirect: 'manual'}).then(function (response) {\n            data.header = {};\n            response.headers.forEach((value, key) => {\n                data.header[key] = value;\n            });\n            data.header['status_text'] = response.statusText;\n            data.header['status_code'] = response.status;\n            if (VariableDefine.debugMode) console.log(data);\n            if (response.redirected) {\n                return false\n            } else {\n                if (response.status !== 200) {\n                    return false;\n                }\n                return response.text();\n            }\n        }).then(response => {\n            if (VariableDefine.debugMode) console.log(response.toString().length, response.toString().indexOf('Type the characters you see'));\n            if (response) {\n                if (response.toString().indexOf('Type the characters you see') !== -1) {\n                    //console.log(\"ErrorCaptcha\", response);\n                    this.ScarpingEnd()\n                    setTimeout(ScrapCollection, (restartTime * 2));\n                    return response;\n                }\n            }\n            let tab = null;\n            if (data.type == 'application/json') {\n                let abort_controller = new AbortController();\n                let __id = setTimeout((handler) => {\n                    abort_controller.abort();\n                    Browser.runtime.sendMessage(Browser.runtime.id, {fn: 'ScarpingEnd', data: null}, (response) => response);\n                }, 50000);\n                data.data = response;\n                data.header = response;\n                fetch(api_url + '/extensions/scraping/set?time=' + (new Date().toISOString().replaceAll(/-/g, '_')), {\n                    'method': 'POST',\n                    body: JSON.stringify(data),\n                    signal: abort_controller.signal,\n                })\n            } else {\n                Browser.tabs.query({status: \"complete\"}).then((tabs) => {\n                    if (tabs) {\n                        let tab_ = tabs.forEach((_tab) => {\n                            if (!tab && _tab.url.indexOf('https://') !== -1 && _tab.url.indexOf('webstore') === -1) tab = _tab;\n                        });\n                        if (typeof tab.id === 'undefined') {\n                            setTimeout(() => {\n                                this.ScrapCall(data);\n                            }, restartTime * 2);\n                            return\n                        }\n                        Browser.scripting.executeScript(\n                            {\n                                target: {tabId: tab.id},\n                                function: Scraping,\n                                args: [response, data.type, data.elements, data, VariableDefine.api_url, data.header, 0, Browser]\n                            }).then((response) => {\n                            /*if (ScrapStart == 1) {\n                                console.log(tab);\n                                this.ScarpingEnd()\n                            }*/\n                            return response;\n                        }).catch((response) => {\n                            if (VariableDefine.debugMode) console.log(response, \"Catch:161\");\n                            //ScarpingEnd();\n                        });\n                    } else {\n                        return ScrapCall(data);\n                    }\n                }).catch((response) => {\n                    if (VariableDefine.debugMode) console.log(response, \"Catch:168\");\n                    //ScarpingEnd();\n                });\n            }\n        }).catch((response) => {\n            if (VariableDefine.debugMode) console.log(response, \"Catch:174\");\n            //ScarpingEnd();\n        });\n    }\n\n    this.Scraping = (html, type, elements, scheme = {}, api_url = null, header = [], sent_try = 0, _Browser = null) => {\n        if (_Browser == null && typeof Browser != 'undefined') _Browser = (Browser) ?? null;\n        if (typeof _Browser.runtime == 'undefined' && typeof chrome != 'undefined') _Browser = chrome;\n        if (api_url == null) api_url = (VariableDefine.api_url) ?? null;\n        let dom = new DOMParser();\n        let _html = dom.parseFromString(html, type);\n        let html_response = \"\";\n        if (elements) {\n            elements.forEach(function (element) {\n                _html.querySelectorAll(element).forEach(function (el) {\n                    html_response += el.outerHTML;\n                })\n            });\n            scheme.data = html_response;\n            scheme.header = header;\n            let abort_controller = new AbortController();\n            let __id = setTimeout((handler) => {\n                abort_controller.abort();\n                _Browser.runtime.sendMessage(_Browser.runtime.id, {fn: 'ScarpingEnd', data: null}, (response) => response);\n            }, 50000);\n            fetch(api_url + '/extensions/scraping/set?time=' + (new Date().toISOString().replaceAll(/-/g, '_')), {\n                'method': 'POST',\n                body: JSON.stringify(scheme),\n                signal: abort_controller.signal\n            }).then(response => response.text()).then(response => {\n                response = JSON.parse(response);\n                let _letDate = (new Date().toISOString().replaceAll(/-/g, '_'));\n                //console.log(_letDate);\n                /*document.querySelector(\"body\").insertAdjacentHTML('beforebegin', _letDate + \"<hr>\");*/\n                if (typeof response.data != 'undefined') {\n                    if (typeof response.data.collection_type !== 'undefined' && response.status === 'success') {\n                        let _waitTime = response.data.wait_time ?? 8000;\n                        let _time = ((Math.random() + 1) * (_waitTime / 2)).toFixed(0);\n                        clearTimeout(__id);\n                        __id = null;\n                        setTimeout(() => {\n                            _Browser.runtime.sendMessage(_Browser.runtime.id, {fn: 'ScrapCall', data: response.data, api_url: api_url}, (response) => response);\n                        }, _time);\n                        return response;\n                    }\n                }\n                _Browser.runtime.sendMessage(_Browser.runtime.id, {fn: 'ScarpingEnd', data: null}, (response) => response);\n                if (__id) clearTimeout(__id);\n            }).catch((handler) => {\n                abort_controller.abort();\n                if (__id) clearTimeout(__id);\n                if (sent_try < 2) {\n                    sent_try++;\n                    console.log(handler, 'Catch');\n                    setTimeout((handler) => {\n                        this.Scraping(html, type, elements, scheme, VariableDefine.api_url, header, sent_try, _Browser)\n                        clearTimeout(handler);\n                    }, 50000);\n                    return false;\n                }\n                if (typeof _Browser.runtime.sendMessage != 'undefined') {\n                    setTimeout(() => {\n                        _Browser.runtime.sendMessage(_Browser.runtime.id, {fn: 'ScarpingEnd', data: null}, (response) => response);\n                    }, 60000);\n                } else {\n                    setTimeout(() => {\n                        _Browser.runtime.sendMessage(_Browser.runtime.id, {fn: 'ScarpingEnd', data: null}, (response) => response);\n                    }, 60000);\n                }\n            });\n            return false;\n        }\n    }\n\n    this.ScarpingEnd = () => {\n        if (VariableDefine.debugMode) console.log(\"Finish\", restartTime);\n        ScrapCount++;\n        setTimeout(() => {\n            Browser.storage.local.set({'start_scrap': 0}).then(() => {\n                ScrapCollection();\n            });\n        }, restartTime);\n    }\n\n    this.ScrapingCheck = () => {\n        if (appStatus == 0) return;\n        let _sc = ((Date.now() - ScrapTime) / 600).toFixed(0);\n        let _ch_sc = ((restartTime * 10) / 1000).toFixed(0)\n        if (VariableDefine.debugMode) console.log('ScrapingChack', _sc, _ch_sc, Date.now(), ScrapTime);\n        if (_sc > _ch_sc) {\n            LastScrapCount = ScrapCount;\n            ScarpingEnd();\n            ScrapCollection();\n        }\n    }\n\n    this.ScrappingInit = () => {\n        Helpers.setKey().then();\n        ScrapCollection();\n        /*Helpers.customAddListener(Browser.tabs, ['onCreated', 'onUpdated'], [ScrapingCheck]);*/\n    }\n    ScrappingInit();\n}",
    "import Browser from \"webextension-polyfill\";\nimport \"./plugins/captaina/functions/message.js\";\nimport \"./plugins/captaina/functions/alarm.js\";\nimport \"./plugins/captaina/workers/scraping.js\";\nimport {Helpers} from \"./classes/Helpers\";\nimport {constants} from \"./classes/Constants\";\n\nlet isRun = false;\nlet isClear = false;\nlet _removeStorage = ['token_usage', 'credits', 'licences', 'uuid_hopekey', 'uuid_search', 'expires', 'credit_usage', 'credit_detail', 'credit_detail_visual', 'start_scrap', 'language_var_sync', 'language_variables', 'languages', 'ai_models'/*, 'settings'*/, 'ai_prompts', 'selected_ask', 'selected_question', 'selected_write', 'prompt_settings', 'model_settings', 'files', 'faq', 'packages',/*, 'ai_image'*/];\nlet _removeStorageExtra = {'ai_single': [Helpers.SHA1('image')]};\n\nvar reloadApp = (details) => {\n    if (!isClear) {\n        if (details.reason == 'install') _removeStorage.push('settings');\n        Browser.storage.local.remove(_removeStorage).then();\n        Object.keys(_removeStorageExtra).forEach(remove_key => {\n            Browser.storage.local.get(remove_key).then(result => {\n                if (typeof result[remove_key] != 'undefined') {\n                    let check = false;\n                    let json = false;\n                    try {\n                        result[remove_key] = JSON.parse(result[remove_key]);\n                        json = true;\n                    } catch (e) {\n\n                    }\n                    let extra_keys = _removeStorageExtra[remove_key];\n                    Object.keys(result[remove_key]).forEach(extra_key => {\n                        if (extra_keys.indexOf(extra_key) === -1) {\n                            check = true;\n                            delete result[remove_key][extra_key];\n                        }\n                    });\n                    if (json) result[remove_key] = JSON.stringify(result[remove_key]);\n                    if (check) Browser.storage.local.set(result).then();\n                }\n            });\n        });\n        Browser.storage.sync.remove(['uuid_hopekey', 'uuid_search', 'ai_setup']).then();\n        Browser.storage.local.set({show_sidebar: false}).then();\n        console.log(\"clearStorage\");\n        Browser.tabs.query({url: 'https://*.chatgptextension.ai/setup'}).then((tabs) => {\n            tabs.forEach(tab => {\n                console.log(tab);\n                Browser.tabs.remove(tab.id);\n            });\n        });\n    }\n    if (isRun) return;\n    isRun = true;\n    Helpers.uuid(1).then(() => {\n        //if (details.reason == 'install') Helpers.openPage({url: (constants.site + '/setup')});\n        if (details.reason == 'install') Helpers.openPage({url: (constants.extension_dir + 'src/html/setup.html')});\n    });\n};\n\nBrowser.runtime.onInstalled.addListener(async (details) => {\n    return reloadApp(details);\n});\n\n/*import {Helpers} from \"./classes/Helpers\";\nHelpers.storageLocalClearAll(true);*/\nBrowser.runtime.onUpdateAvailable.addListener((details) => {\n        Browser.runtime.reload();\n        return reloadApp(details);\n    }\n);\n\nBrowser.runtime.setUninstallURL(constants.site + '/uninstall');\n\nBrowser.storage.sync.get('uuid_hopekey').then(result => {\n    if ((result.uuid_hopekey as any) == null) {\n        Helpers.uuid(1).then(() => {\n            return Helpers.getModelSettings().then();\n        });\n    }\n});\n//Helpers.getPrompts().then();\n/*Helpers.uuid().then();\nisRun = true;*/\n\nBrowser.action.onClicked.addListener((event) => {\n    (Browser as any).sidePanel\n        .setPanelBehavior({openPanelOnActionClick: true})\n        .catch((error) => console.error(error));\n    (Browser as any).sidePanel.setOptions({\n        enabled: true\n    });\n});\n\n// Set the screen capture image to the local storage to be used in the sidebar\nBrowser.runtime.onMessage.addListener((message) => {\n    if (message.fn == 'action.onCaptureScreen') {\n        const {data} = message.data;\n        const {x, y, width, height, windowWidth} = data;\n\n        // if the image is not selected, do nothing\n        if (!width || !height) return;\n\n        // crop the image to the selected area\n        Helpers.captureCurrentViewport().then((result: string) => {\n            // result is a base64 encoded image string\n            // This logic might be moved to the Helpers class\n            fetch(result)\n                .then(res => res.blob())\n                .then(blob => {\n                    createImageBitmap(blob).then(img => {\n                        const scaleFactor = img.width / windowWidth;\n                        const scaledX = x * scaleFactor;\n                        const scaledY = y * scaleFactor;\n                        const scaledWidth = width * scaleFactor;\n                        const scaledHeight = height * scaleFactor;\n\n                        const canvas = new OffscreenCanvas(scaledWidth, scaledHeight);\n                        const ctx = canvas.getContext('2d');\n                        ctx.drawImage(img, scaledX, scaledY, scaledWidth, scaledHeight, 0, 0, scaledWidth, scaledHeight);\n                        canvas.convertToBlob().then(blob => {\n                            const reader = new FileReader();\n                            reader.readAsDataURL(blob);\n                            reader.onloadend = () => {\n                                const base64data = reader.result;\n                                // set the image to the local storage\n                                Browser.storage.local.set({ai_image_url: base64data}).then();\n                            };\n                        });\n                    });\n                });\n        }).catch((error) => console.error(error));\n    }\n});"
  ],
  "names": [
    "Browser",
    "callback",
    "sender",
    "sendResponse",
    "data",
    "return_data",
    "Helpers",
    "_fn_get_builder",
    "waitTime",
    "restartTime",
    "appStatus",
    "collections",
    "_start",
    "VariableDefine",
    "item",
    "key",
    "_fn_item_builder",
    "ScrapStart",
    "ScrapCount",
    "ScrapTime",
    "this",
    "_time",
    "result",
    "response",
    "api_url",
    "headers",
    "value",
    "tab",
    "abort_controller",
    "handler",
    "tabs",
    "_tab",
    "html",
    "type",
    "elements",
    "scheme",
    "header",
    "sent_try",
    "_Browser",
    "_html",
    "html_response",
    "element",
    "el",
    "__id",
    "_waitTime",
    "_sc",
    "_ch_sc",
    "isRun",
    "_removeStorage",
    "_removeStorageExtra",
    "reloadApp",
    "details",
    "remove_key",
    "check",
    "json",
    "extra_keys",
    "extra_key",
    "constants",
    "event",
    "error",
    "message",
    "x",
    "y",
    "width",
    "height",
    "windowWidth",
    "res",
    "blob",
    "img",
    "scaleFactor",
    "scaledX",
    "scaledY",
    "scaledWidth",
    "scaledHeight",
    "canvas",
    "reader",
    "base64data"
  ],
  "mappings": "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"
}
